<!DOCTYPE html>
<html>
<head>
    <title>Student Attendance Viewer</title>
    <style>
        body {
            font-family: Arial;
            padding: 20px;
        }

        .card {
            max-width: 400px;
            border: 1px solid #ccc;
            padding: 15px;
            margin-top: 20px;
            border-radius: 8px;
            font-size: 16px;
        }

        .row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #eee;
        }

        .label {
            font-weight: bold;
        }

        .value {
            text-align: right;
        }
        .status-eligible {
            color: green;
            font-weight: bold;
        }

        .status-not-eligible {
            color: red;
            font-weight: bold;
        }

    </style>
</head>

<body>

<h1>Android Application Development</h1>
<h2>Student Attendance</h2>

<label>Select Section:</label>
<select id="sectionSelect" onchange="loadAttendanceFile()">
    <option value="">-- Select --</option>
    <option value="csea">CSE A</option>
    <option value="cseb">CSE B</option>
</select>

<br><br>

<label>Select Attendance Type:</label>
<select id="typeSelect" onchange="loadAttendanceFile()">
    <option value="">-- Select --</option>
    <option value="t">Theory</option>
    <option value="p">Practical</option>
</select>

<br><br>

<label>Select Enrollment Number:</label>
<select id="enrollmentSelect" onchange="filterAttendance()">
    <option value="">-- Select --</option>
</select>

<div id="attendanceCard" class="card"></div>

<script>
let attendanceData = [];

function loadAttendanceFile() {
    let section = document.getElementById("sectionSelect").value;
    let type = document.getElementById("typeSelect").value;
    let file = "";

    if (section && type) {
        file = section + type + ".csv";  
        // cseat.csv, cseap.csv, csebt.csv, csebp.csv
    } else {
        return;
    }

    fetch(file)
        .then(res => res.text())
        .then(data => {
            attendanceData = [];
            let rows = data.split("\n");
            rows.shift();

            rows.forEach(row => {
                if (!row.trim()) return;
                let cols = row.split(",");

                attendanceData.push({
                    enroll: cols[0],
                    name: cols[1],
                    type: cols[2],
                    tp: cols[3],
                    tab: cols[4],
                    per: cols[5],
                    sta: cols[6]
                });
            });

            loadEnrollmentDropdown();
        });
}

function loadEnrollmentDropdown() {
    let select = document.getElementById("enrollmentSelect");
    select.innerHTML = '<option value="">-- Select --</option>';

    [...new Set(attendanceData.map(a => a.enroll))].forEach(enroll => {
        let opt = document.createElement("option");
        opt.value = enroll;
        opt.textContent = enroll;
        select.appendChild(opt);
    });

    document.getElementById("attendanceCard").innerHTML = "";
}

function filterAttendance() {
    let enroll = document.getElementById("enrollmentSelect").value;
    let card = document.getElementById("attendanceCard");

    let result = attendanceData.find(a => a.enroll === enroll);
    if (!result) return;

    let statusText = result.sta.trim().toLowerCase();
    let statusClass = (statusText === "eligible")
        ? "status-eligible"
        : "status-not-eligible";

    card.innerHTML = `
        <div class="row"><div class="label">Enrollment No</div><div class="value">${result.enroll}</div></div>
        <div class="row"><div class="label">Name</div><div class="value">${result.name}</div></div>
        <div class="row"><div class="label">Type</div><div class="value">${result.type}</div></div>
        <div class="row"><div class="label">Total Present</div><div class="value">${result.tp}</div></div>
        <div class="row"><div class="label">Total Absent</div><div class="value">${result.tab}</div></div>
        <div class="row"><div class="label">Percentage</div><div class="value">${result.per}</div></div>
        <div class="row">
            <div class="label">Status</div>
            <div class="value ${statusClass}">${result.sta}</div>
        </div>
    `;
}

</script>

</body>
</html>
